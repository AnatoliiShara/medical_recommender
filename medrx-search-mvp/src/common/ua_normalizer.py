# -*- coding: utf-8 -*-
import re
from typing import Dict

MULTISPACE_RE = re.compile(r"\s+")
PUNCT_RE = re.compile(r"[^\w\s\-–—/]+", flags=re.UNICODE)

# Мінімальний словничок синонімів (можеш доповнювати без перезапуску індексу)
UA_SYNONYMS: Dict[str, str] = {
    "нежить": "риніт",
    "горло болить": "фарингіт",
    "ангіна": "тонзиліт",
    "застуда": "ГРВІ",
    "печія": "рефлюкс",
    "цукровий діабет": "діабет",
    "підвищений тиск": "артеріальна гіпертензія",
    "високий тиск": "артеріальна гіпертензія",
    "спк": "синдром подразненого кишечнику",
    "мігрень": "мігрень",
    "понос" : "діарея",
    "задуха": "астма",
"гостець": "ревматизм",
"жовтуха": "жовтяниця",
"пропасниця": "лихоманка",
"глисти": "гельмінтоз",
"золотуха": "скрофульоз",
"ячмінь": "гордеолум",
"бешиха": "бешиха",
"пліснявка": "стоматит",
"жовна": "паротит",
"воло": "зоб",
"ружі": "бешиха",
"чорна хвороба": "епілепсія",
"горячка": "тиф",
"відмороження": "відмороження",
"отруєння": "інтоксикація",
"головний біль": "цефалгія",
"пухлина": "неоплазма",
"нарив": "абсцес",
"виразка": "виразкова хвороба",
"вітрянка": "вітряна віспа",
"свинка": "епідемічний паротит",
"геморой": "геморой",
"цистит": "цистит",
"гастрит": "гастрит",
"панкреатит": "панкреатит",
"холецистит": "холецистит",
"гепатит": "гепатит",
"цироз": "цироз печінки",
"артрит": "артрит",
"радикуліт": "радикуліт",
"інсомнія": "безсоння",
"закреп": "запор",
"кашель": "кашель",
"гайморит": "синусит",
"отит": "отит"
}

# Дуже легка «лематизація» для імен (не NLP, а безпечний стемминг)
def _light_lemma(word: str) -> str:
    w = word
    for suf in ["ами", "ами", "ами", "ами", "ами", "ами", "ями", "ями", "ами", "у", "ю", "а", "я", "і", "ї", "е", "є", "о", "и"]:
        if len(w) > 5 and w.endswith(suf):
            return w[:-len(suf)]
    return w

def normalize_text(s: str) -> str:
    if not isinstance(s, str):
        return ""
    s = s.lower().strip()
    s = s.replace("\u00A0", " ")
    s = PUNCT_RE.sub(" ", s)
    s = MULTISPACE_RE.sub(" ", s)
    return s.strip()

def normalize_query(s: str) -> str:
    s = normalize_text(s)
    # синоніми (фрази → заміни)
    for k, v in UA_SYNONYMS.items():
        s = s.replace(k, v)
    # легка лематизація по словах
    toks = [ _light_lemma(t) for t in s.split() ]
    return " ".join(toks).strip()
